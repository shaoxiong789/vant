<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-Equiv="Cache-Control" Content="no-cache" />
  <meta http-Equiv="Pragma" Content="no-cache" />
  <meta http-Equiv="Expires" Content="0" />
  <link rel="shortcut icon" href="https://img.yzcdn.cn/zanui/vant/vant-2017-12-18.ico">
  <title>Vant - 轻量、可靠的移动端 Vue 组件库</title>
  <script>window.Promise || document.write('<script src="//img.yzcdn.cn/huiyi/build/h5/js/pinkie.min.js"><\/script>');</script>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="../lib/vant-css/index.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
</head>
<body ontouchstart>
<div><input type="button" id="button" value="按钮"></div>
<div id="app"></div>
<!-- 引入组件 -->
<script src="https://unpkg.com/vue/dist/vue.min.js"></script>
<script src="../lib/vant.js"></script>

<script>
Vue.use(vant);
(function($) {
  var app = null;
  var methods = {
    init: function(method){
      var $el = this[0];
      app = new Vue({
        el: $el,
        data: {
          show: false,
          result: {
            dep: [],
            emp: []
          }
        },
        methods: {
          ajaxRequest({key = undefined,url = undefined, urlParams = {}} = {}) {
            return new Promise((resolve, reject) => {
              axios.post('http://rap2api.taobao.org/app/mock/18224//app/chooser/books2.htm', {
                key,
                urlParams
              }).then(({ data }) => {
                resolve(data.data);
              });
            });
          },
          open() {
            this.show = true;
          },
          close() {
            this.show = false;
          },
          onFinish(result) {
            if( typeof method === 'function' ) {
              method(result)
            }
          },

        },
        template: `
          <div>
            <van-popup style="width:100%;height:100%;" v-model="show" position="right" :overlay="false">
                <van-nav-bar
                  title="选择人员"
                  left-arrow
                  @click-left="show = false"
                />
              <van-employee-field style="height: calc(100% - 46px);"
              company-id="0" @finish="onFinish" company-name="喔趣信息科技" v-model="result" :ajax-request="ajaxRequest"/>
            </van-popup>
          </div>
        `
      })
    },
    show: function(){
      app.open();
    },
    hide: function(){
      app.close();
    },

  }
  $.fn.employeeField = function(method) {
    // Method calling logic
    if (typeof method === 'string' && methods[method] ) {
      return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
    } else if ( typeof method === 'function' || typeof method === 'object' || ! method ) {
      return methods.init.apply( this, arguments );
    } else {
      $.error( 'Method ' +  method + ' does not exist on jQuery.employeeField' );
    }
  }
})(jQuery)

$('#app').employeeField(function(result) {
  console.log(result)
  $('#app').employeeField('hide')
})

$('#button').click(function(){
  $('#app').employeeField('show')
});
</script>
</html>
